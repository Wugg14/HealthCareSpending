<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <title>Health Care Spending as a Percentage of GDP over time</title>

    <script type="text/javascript">
        function draw(data){
              /*
                D3.js setup code
               */
            "use strict";
            const margin = 75,
                width = 1400 - margin,
                height = 600 - margin;

            let svg = d3.select("body")
                .append("div")
                .style("width", width + margin)
                .style("height", height + margin)
                .attr('class','chart');

            let year = data[1];
            debugger;

            let restructured = function(){
                let structuredArray = [];
                let countryKeys = Object.keys(year);
                let numericalValues = Object.values(year);
                let totalNumber = countryKeys.length;
                for(let i = 1; i < totalNumber; i++) {
                    structuredArray.push({"Country": countryKeys[i], "Spending": numericalValues[i]});
                }
                return structuredArray;
            };

            console.log(restructured());

            d3.select(".chart")
                .selectAll("div")
                .data(restructured)
                .enter()
                .append("div")
                .style('width', function(d){
                    if(d['Spending'] === "null"){
                        return '5px';
                    }
                    return d['Spending'] * 100 + 'px';
            })
                .style("height", "50px")
                .style("background-color", "lightBlue")
                .style("border", "1px solid black")
                .text(function(d){
                    return d["Country"];
                })
        }
    </script>
</head>
<body>
<h1>Health Care Spending as a Percentage of GDP</h1>
<script>
    d3.csv('healthcarespending.csv').then(draw)
</script>
</body>
</html>